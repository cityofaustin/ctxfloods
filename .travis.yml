language: node_js
node_js:
- node
addons:
  postgresql: 9.4
services:
  - postgresql

jobs:
  include:
    - stage: Test Locally
      before_script: cd backend; yarn init-local-db; yarn local-drop-rebuild
      script: cd backend; yarn postgraphql-local & yarn test
    - stage: Deploy to AWS
      before_script: npm install -g serverless
      script: ./backend/travisDeploy.sh
    - stage: Test against AWS endpoint
      script: cd backend; yarn test-on-aws
