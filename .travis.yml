language: node_js
node_js:
- node
addons:
  postgresql: 9.4
services:
  - postgresql

jobs:
  include:
    - stage: Test Backend Locally
      before_script: cd backend; yarn; yarn init-local-db; yarn local-drop-rebuild
      script: cd backend; yarn postgraphql-local & yarn test
    - stage: Deploy Backend to AWS
      before_script: npm install -g serverless
      script: cd backend; ./travisDeploy.sh
    - stage: Test against AWS endpoint
      script: cd backend; yarn; yarn test-on-aws
